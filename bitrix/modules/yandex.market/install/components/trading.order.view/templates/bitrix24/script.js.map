{"version":3,"file":"script.js","sources":["src/factory.js","src/utils.js","src/reference/field.js","src/basket/summaryskeleton.js","src/basket/cis.js","src/basket/digital.js","src/bracketchain.js","src/basket/itemview.js","src/basket/itemedit.js","src/basket/field.js","src/basketconfirm/field.js","src/box/itemview.js","src/box/itemedit.js","src/box/collection.js","src/shipment/field.js","src/property/field.js","src/print/field.js","src/notification/field.js","src/index.js","src/compatible/editor.js"],"sourcesContent":["const BX = window.BX;\r\n\r\nexport default class Factory {\r\n\r\n\tstatic defaults = {\r\n\t\tname: 'yamarket',\r\n\t\tmap: {},\r\n\t}\r\n\r\n\tconstructor(options = {}) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\tregister() {\r\n\t\tif (this.isEditorInitialized()) {\r\n\t\t\tthis.registerEditorMethod();\r\n\t\t} else {\r\n\t\t\tthis.handleEditorInit(true);\r\n\t\t}\r\n\t}\r\n\r\n\tisEditorInitialized() {\r\n\t\treturn BX.UI?.EntityEditorControlFactory?.initialized;\r\n\t}\r\n\r\n\tregisterEditorMethod() {\r\n\t\tBX.UI.EntityEditorControlFactory.registerFactoryMethod(this.options.name, this.build);\r\n\t}\r\n\r\n\thandleEditorInit(dir) {\r\n\t\tBX[dir ? 'addCustomEvent' : 'removeCustomEvent'](window, 'BX.UI.EntityEditorControlFactory:onInitialize', this.onEditorInit);\r\n\t}\r\n\r\n\tonEditorInit = (factory, event) => {\r\n\t\tevent.methods[this.options.name] = this.build;\r\n\t\tthis.handleEditorInit(false);\r\n\t}\r\n\r\n\tbuild = (type, controlId, settings) => {\r\n\t\tconst prefix = this.options.name + '_';\r\n\r\n\t\tif (type.indexOf(prefix) !== 0) { return null; }\r\n\r\n\t\tconst internalType = type.substr(prefix.length);\r\n\r\n\t\tif (!this.options.map.hasOwnProperty(internalType)) { return null; }\r\n\r\n\t\tconst fieldClass = this.options.map[internalType];\r\n\r\n\t\treturn fieldClass.create(controlId, settings);\r\n\t}\r\n}","export function htmlToElement(html, tag = 'div') {\r\n\tconst renderer = document.createElement(tag);\r\n\r\n\trenderer.innerHTML = html;\r\n\r\n\treturn renderer.firstElementChild;\r\n}\r\n\r\nexport function pascalCase(str) {\r\n\treturn str\r\n\t\t.split('_')\r\n\t\t.map((word) => word.substr(0, 1).toUpperCase() + word.substr(1).toLowerCase())\r\n\t\t.join('');\r\n}\r\n\r\nexport function camelCase(str) {\r\n\treturn str\r\n\t\t.split('_')\r\n\t\t.map((word, index) => index === 0 ? word.toLowerCase() : word.substr(0, 1).toUpperCase() + word.substr(1).toLowerCase())\r\n\t\t.join('');\r\n}\r\n\r\nexport function kebabCase(str) {\r\n\treturn str\r\n\t\t.split('_')\r\n\t\t.map((word, index) =>  word.toLowerCase())\r\n\t\t.join('-');\r\n}\r\n\r\nexport function copyValues(from, to) {\r\n\tconst fromValues = collectValues(from);\r\n\r\n\treturn fillValues(to, fromValues);\r\n}\r\n\r\nexport function collectValues(container) {\r\n\tconst inputs = findInputs(container);\r\n\tconst result = {};\r\n\r\n\tfor (const [name, input] of Object.entries(inputs)) {\r\n\t\tif (input.tagName.toLowerCase() === 'select') {\r\n\t\t\tfor (const option of input.querySelectorAll('option')) {\r\n\t\t\t\tif (!option.selected) { continue; }\r\n\r\n\t\t\t\tresult[name] = option.value;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tresult[name] = input.value;\r\n\t\t}\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function fillValues(container, values) {\r\n\tconst inputs = findInputs(container);\r\n\tlet isChanged = false;\r\n\r\n\tfor (const [name, value] of Object.entries(values)) {\r\n\t\tif (inputs[name] == null) { continue; }\r\n\r\n\t\tconst input = inputs[name];\r\n\r\n\t\tif (input.tagName.toLowerCase() === 'select') {\r\n\t\t\tfor (const option of input.querySelectorAll('option')) {\r\n\t\t\t\tconst selected = (option.value === value);\r\n\r\n\t\t\t\tif (selected === Boolean(option.selected)) { continue; }\r\n\r\n\t\t\t\toption.selected = selected;\r\n\t\t\t\tisChanged = true;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (input.value === value) { continue; }\r\n\r\n\t\t\tisChanged = true;\r\n\t\t\tinput.value = value;\r\n\t\t}\r\n\t}\r\n\r\n\treturn isChanged;\r\n}\r\n\r\nexport function findInputs(container) {\r\n\tconst inputs = container.querySelectorAll('input, select, textarea');\r\n\tconst result = {};\r\n\r\n\tfor (const input of inputs) {\r\n\t\tif (!input.name) { continue; }\r\n\r\n\t\tresult[input.name] = input;\r\n\t}\r\n\r\n\treturn result;\r\n}\r\n\r\nexport function replaceTemplateVariables(template, variables) {\r\n\tlet result = template;\r\n\r\n\tif (variables == null) { return result; }\r\n\r\n\tfor (const [key, value] of Object.entries(variables)) {\r\n\t\tresult = result.replace('#' + key + '#', value);\r\n\t}\r\n\r\n\treturn result;\r\n}","import {replaceTemplateVariables} from \"../utils\";\r\n\r\nexport default class Field extends BX.UI.EntityEditorField {\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._hasLayout = false;\r\n\t\tthis.options = this.constructor.defaults != null\r\n\t\t\t? Object.assign({}, this.constructor.defaults)\r\n\t\t\t: {};\r\n\t}\r\n\r\n\tgetMessage(key, replaces = null) {\r\n\t\tlet result = this.constructor.messages[key] || super.getMessage(key);\r\n\r\n\t\tif (replaces != null) {\r\n\t\t\tresult = replaceTemplateVariables(result, replaces);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tclearLayout() {\r\n\t\tif (!this._hasLayout) { return; }\r\n\r\n\t\tthis.forget();\r\n\r\n\t\tthis._wrapper.innerHTML = '';\r\n\t\tthis._hasLayout = false;\r\n\t}\r\n\r\n\tlayout(options) {\r\n\t\tif (this._hasLayout) { return; }\r\n\r\n\t\tthis.ensureWrapperCreated({});\r\n\t\tthis.adjustWrapper();\r\n\r\n\t\tif (!this.isNeedToDisplay()) {\r\n\t\t\tthis.registerLayout(options);\r\n\t\t\tthis._hasLayout = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.forget();\r\n\r\n\t\tthis._wrapper.innerHTML = '';\r\n\r\n\t\tif (this.isDragEnabled()) {\r\n\t\t\tthis._wrapper.appendChild(this.createDragButton());\r\n\t\t}\r\n\r\n\t\tif (this.useTitle()) {\r\n\t\t\tconst title = this.getTitle();\r\n\t\t\tthis._wrapper.appendChild(this.createTitleNode(title));\r\n\t\t}\r\n\r\n\t\tthis.render(this.getValue());\r\n\r\n\t\tif (this.isContextMenuEnabled()) {\r\n\t\t\tthis._wrapper.appendChild(this.createContextMenuButton());\r\n\t\t}\r\n\r\n\t\tif (this.isDragEnabled()) {\r\n\t\t\tthis.initializeDragDropAbilities();\r\n\t\t}\r\n\r\n\t\tthis.registerLayout(options);\r\n\t\tthis._hasLayout = true;\r\n\t}\r\n\r\n\tforget() {}\r\n\r\n\trender(payload) {}\r\n\r\n\tuseTitle() {\r\n\t\treturn false;\r\n\t}\r\n\r\n\tfewElements(key) {\r\n\t\tconst selector = this.getElementSelector(key);\r\n\t\tlet result;\r\n\r\n\t\tif (selector.indexOf('#') === 0) {\r\n\t\t\tresult = document.querySelectorAll(selector);\r\n\t\t} else {\r\n\t\t\tresult = this.el.querySelectorAll(selector);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetElement(key) {\r\n\t\tconst selector = this.getElementSelector(key);\r\n\t\tlet result;\r\n\r\n\t\tif (selector.indexOf('#') === 0) {\r\n\t\t\tresult = document.querySelector(selector);\r\n\t\t} else {\r\n\t\t\tresult = this.el.querySelector(selector);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetElementSelector(key) {\r\n\t\treturn this.options[key + 'Element'];\r\n\t}\r\n}","import {copyValues, replaceTemplateVariables} from \"../utils\";\r\nimport './summary.css';\r\n\r\nexport default class SummarySkeleton {\r\n\r\n\tstatic STATUS_READY = 'READY';\r\n\tstatic STATUS_WAIT = 'WAIT';\r\n\tstatic STATUS_EMPTY = 'EMPTY';\r\n\r\n\tstatic defaults = {\r\n\t\tmodalElement: '.yamarket-item-summary__modal',\r\n\t\tstatusElement: '.yamarket-item-summary__status',\r\n\t\tinputElement: 'input',\r\n\r\n\t\tname: null,\r\n\t\tmessages: {},\r\n\t\tonChange: null,\r\n\t};\r\n\r\n\tconstructor(options) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis.el = null;\r\n\t}\r\n\r\n\tbind() {\r\n\t\tthis.handleStatusClick(true);\r\n\t}\r\n\r\n\thandleStatusClick(dir) {\r\n\t\tconst status = this.getElement('status');\r\n\r\n\t\tstatus[dir ? 'addEventListener' : 'removeEventListener']('click', this.onStatusClick);\r\n\t}\r\n\r\n\tonStatusClick = (evt) => {\r\n\t\tthis.openDialog();\r\n\t\tevt.preventDefault();\r\n\t}\r\n\r\n\tsetup(element) {\r\n\t\tthis.el = element;\r\n\t\tthis.bind();\r\n\t}\r\n\r\n\tbuild() {\r\n\t\treturn `<div class=\"yamarket-item-summary\">\r\n\t\t\t${this.buildStatus()}\r\n\t\t\t<div class=\"yamarket-item-summary__modal\" hidden>\r\n\t\t\t\t${this.buildForm()}\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tbuildStatus() {\r\n\t\tconst cises = this.optionValue();\r\n\t\tconst status = this.getStatus(cises);\r\n\r\n\t\treturn `<a class=\"yamarket-item-summary__status\" href=\"#\" data-status=\"${status}\">${this.getMessage('SUMMARY_' + status)}</a>`\r\n\t}\r\n\r\n\treflowStatus() {\r\n\t\tconst value = this.formValue();\r\n\t\tconst status = this.getStatus(value);\r\n\t\tconst element = this.getElement('status');\r\n\r\n\t\telement.setAttribute('data-status', status);\r\n\t\telement.textContent = this.getMessage('SUMMARY_' + status);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {any} value\r\n\t *\r\n\t * @return {string}\r\n\t */\r\n\tgetStatus(value) {\r\n\t\tthrow new Error('not implemented');\r\n\t}\r\n\r\n\t/** @return {string} */\r\n\tbuildForm(useFormValue = false) {\r\n\t\tthrow new Error('not implemented');\r\n\t}\r\n\r\n\treflowForm() {\r\n\t\tconst modal = this.el.querySelector('.yamarket-item-summary__modal');\r\n\r\n\t\tmodal.innerHTML = this.buildForm(true);\r\n\t}\r\n\r\n\t/** @return {any} */\r\n\toptionValue() {\r\n\t\tthrow new Error('not implemented');\r\n\t}\r\n\r\n\t/** @return {any} */\r\n\tformValue() {\r\n\t\tthrow new Error('not implemented');\r\n\t}\r\n\r\n\topenDialog() {\r\n\t\tconst modal = this.getElement('modal').firstElementChild;\r\n\t\tconst messageBox = BX.UI.Dialogs.MessageBox.create({\r\n\t\t\ttitle: this.getMessage('MODAL_TITLE'),\r\n\t\t});\r\n\r\n\t\tmessageBox.setMessage(modal.cloneNode(true));\r\n\t\tmessageBox.setButtons([\r\n\t\t\tnew BX.UI.SaveButton({\r\n\t\t\t\tevents: {\r\n\t\t\t\t\tclick: this.onSaveClick.bind(this, messageBox),\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t\tnew BX.UI.CancelButton({\r\n\t\t\t\tevents: {\r\n\t\t\t\t\tclick: this.onCancelClick.bind(this, messageBox),\r\n\t\t\t\t}\r\n\t\t\t}),\r\n\t\t]);\r\n\r\n\t\tmessageBox.show();\r\n\t\tcopyValues(this.el, messageBox.popupWindow.contentContainer);\r\n\t}\r\n\r\n\tonSaveClick(messageBox) {\r\n\t\tconst isChanged = copyValues(messageBox.popupWindow.contentContainer, this.el);\r\n\r\n\t\tif (isChanged && this.options.onChange) {\r\n\t\t\tthis.options.onChange();\r\n\t\t}\r\n\r\n\t\tthis.reflowStatus();\r\n\r\n\t\tmessageBox.close();\r\n\t}\r\n\r\n\tonCancelClick(messageBox) {\r\n\t\tmessageBox.close();\r\n\t}\r\n\r\n\tgetMessage(key, replaces = null) {\r\n\t\tlet result = this.options.messages[key] || key;\r\n\r\n\t\tif (replaces != null) {\r\n\t\t\tresult = replaceTemplateVariables(result, replaces);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tfewElements(key) {\r\n\t\tconst selector = this.getElementSelector(key);\r\n\r\n\t\treturn this.el.querySelectorAll(selector);\r\n\t}\r\n\r\n\tgetElement(key) {\r\n\t\tconst selector = this.getElementSelector(key);\r\n\r\n\t\treturn this.el.querySelector(selector);\r\n\t}\r\n\r\n\tgetElementSelector(key) {\r\n\t\treturn this.options[key + 'Element'];\r\n\t}\r\n\r\n}","import SummarySkeleton from \"./summaryskeleton\";\r\nimport {fillValues, replaceTemplateVariables} from \"../utils\";\r\n\r\nexport default class Cis extends SummarySkeleton {\r\n\r\n\tstatic defaults = Object.assign({}, SummarySkeleton.defaults, {\r\n\t\tcopyElement: '.yamarket-item-summary__copy',\r\n\t\tinputElement: 'input, select',\r\n\r\n\t\ttotal: 0,\r\n\t\trequired: false,\r\n\t\tinstances: [],\r\n\t\tinternalInstances: [],\r\n\t})\r\n\r\n\tbind() {\r\n\t\tsuper.bind();\r\n\t\tthis.handleCopyClick(true);\r\n\t}\r\n\r\n\thandleCopyClick(dir) {\r\n\t\tconst copy = this.getElement('copy');\r\n\r\n\t\tif (copy == null) { return; }\r\n\r\n\t\tcopy[dir ? 'addEventListener' : 'removeEventListener']('click', this.onCopyClick);\r\n\t}\r\n\r\n\tonCopyClick = (evt) => {\r\n\t\tthis.copyInternal();\r\n\t\tevt.preventDefault();\r\n\t}\r\n\r\n\tupdateTotal(count) {\r\n\t\tthis.options.total = count;\r\n\t\tthis.reflowStatus();\r\n\t\tthis.reflowForm();\r\n\t}\r\n\r\n\tbuild() {\r\n\t\tconst internalCises = this.optionValue('internal');\r\n\r\n\t\treturn `<div class=\"yamarket-item-summary\">\r\n\t\t\t${this.buildStatus()}\r\n\t\t\t${internalCises['COUNT'] > 0 ? this.buildCopyIcon() : ''}\r\n\t\t\t<div class=\"yamarket-item-summary__modal\" hidden>\r\n\t\t\t\t${this.buildForm()}\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tbuildCopyIcon() {\r\n\t\treturn `<button class=\"yamarket-item-summary__copy\" type=\"button\" title=\"${this.getMessage('COPY')}\">\r\n\t\t\t${this.getMessage('COPY')}\r\n\t\t</button>`;\r\n\t}\r\n\r\n\tbuildForm(useFormValue = false) {\r\n\t\tconst total = parseInt(this.options.total) || 0;\r\n\t\tconst iterator = (new Array(total)).fill(null);\r\n\t\tconst value = useFormValue ? this.formValue() : this.optionValue();\r\n\r\n\t\treturn `<div class=\"ui-form\">\r\n\t\t\t${iterator.map((dummy, index) => {\r\n\t\t\t\tconst selfName = `ITEMS[${index}]`;\r\n\t\t\t\tconst one = value[selfName] || '';\r\n\t\t\t\t\r\n\t\t\t\treturn `<div class=\"ui-form-row-inline\">\r\n\t\t\t\t\t<div class=\"ui-form-row-inline-col\">\r\n\t\t\t\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t\t\t\t<div class=\"ui-ctl-label-text\">&numero;${index + 1}</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t\t\t<div class=\"ui-ctl ui-ctl-sm ui-ctl-textbox ui-ctl-w100\">\r\n\t\t\t\t\t\t\t<input class=\"ui-ctl-element\" type=\"text\" name=\"${this.inputName(selfName)}\" value=\"${BX.util.htmlspecialchars(one)}\" data-name=\"${selfName}\" />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>`;\r\n\t\t\t}).join('')}\r\n\t\t\t<div class=\"ui-form-row\">\r\n\t\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('FORMAT')}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100\">\r\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\r\n\t\t\t\t\t\t<select class=\"ui-ctl-element\" name=\"${this.inputName('TYPE')}\" data-name=\"TYPE\">\r\n\t\t\t\t\t\t\t${['CIS', 'UIN'].map((typeVariant) => {\t\t\t\t\r\n\t\t\t\t\t\t\t\treturn `<option value=\"${typeVariant}\" ${typeVariant === value['TYPE'] ? 'selected' : ''}>${this.getMessage(typeVariant)}</option>`;\r\n\t\t\t\t\t\t\t}).join('')}\r\n\t\t\t\t\t\t</select>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tgetStatus(value) {\r\n\t\tlet result;\r\n\r\n\t\tif (value['COUNT'] >= this.options.total) {\r\n\t\t\tresult = SummarySkeleton.STATUS_READY;\r\n\t\t} else if (value['COUNT'] > 0 || this.options.required) {\r\n\t\t\tresult = SummarySkeleton.STATUS_WAIT;\r\n\t\t} else {\r\n\t\t\tresult = SummarySkeleton.STATUS_EMPTY;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tcopyInternal(container = this.el) {\r\n\t\tconst isChanged = fillValues(container, this.makeInternalValues());\r\n\r\n\t\tif (!isChanged) { return; }\r\n\r\n\t\tthis.options.onChange && this.options.onChange();\r\n\t\tthis.reflowStatus();\r\n\t}\r\n\r\n\tmakeInternalValues() {\r\n\t\tconst cises = this.optionValue('internal');\r\n\t\tconst result = {};\r\n\r\n\t\tfor (const [key, value] of Object.entries(cises)) {\r\n\t\t\tresult[this.inputName(key)] = value;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tinputName(selfName: string) : string {\r\n\t\tconst bracketPosition = selfName.indexOf('[');\r\n\t\tlet result;\r\n\r\n\t\tif (bracketPosition > 0) {\r\n\t\t\tresult =\r\n\t\t\t\tthis.options.name\r\n\t\t\t\t+ `[${selfName.substring(0, bracketPosition)}]`\r\n\t\t\t\t+ `${selfName.substring(bracketPosition)}`\r\n\t\t} else {\r\n\t\t\tresult = this.options.name + `[${selfName}]`;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tformValue() {\r\n\t\tconst result = {\r\n\t\t\tCOUNT: 0,\r\n\t\t};\r\n\r\n\t\tfor (const input of this.fewElements('input')) {\r\n\t\t\tconst name = String(input.dataset.name).trim();\r\n\t\t\tconst value = input.value.trim();\r\n\r\n\t\t\tif (name === '' || value === '') { continue; }\r\n\r\n\t\t\tresult[name] = value;\r\n\r\n\t\t\tif (/^ITEMS\\[/.test(name)) {\r\n\t\t\t\t++result['COUNT'];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\toptionValue(optionKey = null) {\r\n\t\tconst instances = optionKey != null ? this.options[optionKey + 'Instances'] : this.options.instances;\r\n\t\tconst type = this.instancesType(instances);\r\n\t\tconst result = {\r\n\t\t\tTYPE: type,\r\n\t\t\tCOUNT: 0,\r\n\t\t};\r\n\t\tlet itemIndex = 0;\r\n\r\n\t\tfor (const instance of instances) {\r\n\t\t\tif (instance[type] != null && instance[type].length > 0) {\r\n\t\t\t\tresult[`ITEMS[${itemIndex}]`] = instance[type];\r\n\t\t\t\t++result['COUNT'];\r\n\t\t\t\t++itemIndex;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tinstancesType(instances: Array) : string {\r\n\t\tlet result = null;\r\n\r\n\t\tfor (const instance of instances) {\r\n\t\t\tfor (const type of [ 'UIN', 'CIS' ]) {\r\n\t\t\t\tif (instance[type] != null && instance[type].length > 0) {\r\n\t\t\t\t\tresult = type;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (result != null) { break; }\r\n\t\t}\r\n\r\n\t\treturn result ?? 'CIS';\r\n\t}\r\n\r\n\tgetMessage(key, replaces = null) {\r\n\t\tconst keyWithPrefix = 'ITEM_CIS_' + key;\r\n\t\tconst option = this.options.messages[keyWithPrefix];\r\n\r\n\t\tif (option != null) {\r\n\t\t\treturn replaceTemplateVariables(option, replaces);\r\n\t\t}\r\n\r\n\t\treturn super.getMessage(key, replaces);\r\n\t}\r\n\r\n}","import SummarySkeleton from \"./summaryskeleton\";\r\nimport {collectValues, replaceTemplateVariables} from \"../utils\";\r\nimport {BracketChain} from \"../bracketchain\";\r\n\r\nexport default class Digital extends SummarySkeleton {\r\n\r\n\tstatic defaults = Object.assign({}, SummarySkeleton.defaults, {\r\n\t\titems: [],\r\n\t\ttotal: 0,\r\n\t})\r\n\r\n\tupdateTotal(count) {\r\n\t\tthis.options.total = count;\r\n\t\tthis.reflowStatus();\r\n\t\tthis.reflowForm();\r\n\t}\r\n\r\n\tbuildForm(useFormValue = false) {\r\n\t\tconst total = parseInt(this.options.total) || 0;\r\n\t\tconst formValue = useFormValue ? this.formValue() : this.optionValue();\r\n\r\n\t\treturn `<div class=\"ui-form\">\r\n\t\t\t${this.buildFormCodes(total, formValue)}\r\n\t\t\t${this.buildFormAdditional(total, formValue)}\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tbuildFormCodes(total, formValue) {\r\n\t\tconst hasFew = (total > 1);\r\n\t\tconst iterator = (new Array(total)).fill(null);\r\n\r\n\t\treturn iterator.map((dummy, index) => {\r\n\t\t\tconst oneValue = formValue?.ITEM?.[index] || {};\r\n\r\n\t\t\tlet title = '';\r\n\t\t\tlet fieldset = `<div class=\"ui-form-row\">\r\n\t\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('CODE')}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\r\n\t\t\t\t\t\t<input class=\"ui-ctl-element\" type=\"text\" name=\"${this.options.name}[ITEM][${index}][CODE]\" value=\"${BX.util.htmlspecialchars(oneValue['CODE'] || '')}\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"ui-form-row\">\r\n\t\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('ACTIVATE_TILL')}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t\t<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-datetime ui-ctl-w100\">\r\n\t\t\t\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-calendar\"></div>\r\n\t\t\t\t\t\t<input class=\"ui-ctl-element\" type=\"text\" name=\"${this.options.name}[ITEM][${index}][ACTIVATE_TILL]\" value=\"${BX.util.htmlspecialchars(oneValue['ACTIVATE_TILL'] || '')}\" onclick=\"BX.calendar({node: this, field: this, bTime: false, bHideTime: true})\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>`;\r\n\r\n\t\t\tif (hasFew) {\r\n\t\t\t\ttitle = `<div class=\"yamarket-form-group-title\">${this.getMessage('GROUP', { 'NUMBER': index + 1 })}</div>`;\r\n\t\t\t}\r\n\r\n\t\t\treturn title + fieldset;\r\n\t\t}).join('');\r\n\t}\r\n\r\n\tbuildFormAdditional(total, formValue) {\r\n\t\tconst hasFew = (total > 1);\r\n\t\tlet title = '';\r\n\t\tlet fieldset = `<div class=\"ui-form-row\">\r\n\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('SLIP')}</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t<div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\r\n\t\t\t\t\t<textarea class=\"ui-entity-editor-field-textarea\" name=\"${this.options.name}[SLIP]\" rows=\"5\" required>${BX.util.htmlspecialchars(formValue['SLIP'] || '')}</textarea>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\r\n\t\tif (hasFew) {\r\n\t\t\ttitle = `<div class=\"yamarket-form-group-title\">${this.getMessage('ADDITIONAL')}</div>`;\r\n\t\t}\r\n\r\n\t\treturn title + fieldset;\r\n\t}\r\n\r\n\tgetStatus(value) {\r\n\t\tconst filledItems = this.filterFilledItems(value.ITEM);\r\n\t\tconst isItemsFilled = filledItems.length >= this.options.total;\r\n\t\tconst isSlipFilled = (value['SLIP'] != null && value['SLIP'].trim() !== '');\r\n\r\n\t\treturn (\r\n\t\t\tisItemsFilled && isSlipFilled\r\n\t\t\t\t? SummarySkeleton.STATUS_READY\r\n\t\t\t\t: SummarySkeleton.STATUS_WAIT\r\n\t\t);\r\n\t}\r\n\r\n\tfilterFilledItems(items) {\r\n\t\tconst result = [];\r\n\r\n\t\tfor (const item of items) {\r\n\t\t\tif (item['CODE'] == null || item['CODE'].trim() === '') { continue; }\r\n\t\t\tif (item['ACTIVATE_TILL'] == null || item['ACTIVATE_TILL'].trim() === '') { continue; }\r\n\r\n\t\t\tresult.push(item);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\toptionValue() {\r\n\t\tconst items = Array.isArray(this.options.items) ? this.options.items : [];\r\n\t\tlet slip = '';\r\n\r\n\t\tfor (const item of items) {\r\n\t\t\tif (item['SLIP'] != null && item['SLIP'] !== '') {\r\n\t\t\t\tslip = item['SLIP'];\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\t'ITEM': items,\r\n\t\t\t'SLIP': slip,\r\n\t\t};\r\n\t}\r\n\r\n\tformValue() {\r\n\t\tconst rawValues = collectValues(this.el);\r\n\t\tconst values = BracketChain.toTree(rawValues, this.options.name);\r\n\t\tconst defaults = {\r\n\t\t\t'ITEM': [],\r\n\t\t\t'SLIP': '',\r\n\t\t};\r\n\r\n\t\treturn Object.assign(defaults, values);\r\n\t}\r\n\r\n\tgetMessage(key, replaces = null) {\r\n\t\tconst keyWithPrefix = 'ITEM_DIGITAL_' + key;\r\n\t\tconst option = this.options.messages[keyWithPrefix];\r\n\r\n\t\tif (option != null) {\r\n\t\t\treturn replaceTemplateVariables(option, replaces);\r\n\t\t}\r\n\r\n\t\treturn super.getMessage(key, replaces);\r\n\t}\r\n}","export class BracketChain {\r\n\r\n\tstatic toTree(values, base = null) {\r\n\t\tconst result = {};\r\n\r\n\t\tfor (const key in values) {\r\n\t\t\tif (!values.hasOwnProperty(key)) { continue; }\r\n\r\n\t\t\tconst keyRelative = this.keyRelative(key, base);\r\n\r\n\t\t\tif (keyRelative == null) { continue; }\r\n\r\n\t\t\tconst keyChain = this.valueKeyChain(keyRelative);\r\n\r\n\t\t\tthis.setValueByKeyChain(result, keyChain, values[key]);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic keyRelative(key, base) {\r\n\t\tif (base == null) { return key; }\r\n\t\tif (key.indexOf(base) !== 0) { return null; }\r\n\r\n\t\treturn key.replace(base, '');\r\n\t}\r\n\r\n\tstatic valueKeyChain(key) {\r\n\t\tconst parts = key.split('[');\r\n\t\tconst result = [];\r\n\r\n\t\tfor (const part of parts) {\r\n\t\t\tif (part === '' && result.length === 0) { continue; }\r\n\r\n\t\t\tconst name = part.replace(/]$/, '');\r\n\r\n\t\t\tresult.push(name);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic setValueByKeyChain(result, chain, value) {\r\n\t\tconst lastKey = chain.pop();\r\n\t\tlet level = result;\r\n\r\n\t\tfor (let index = 0; index < chain.length; ++index) {\r\n\t\t\tconst key = chain[index];\r\n\t\t\tconst nextKey = (index + 1 === chain.length) ? lastKey : chain[index + 1];\r\n\r\n\t\t\tif (level[key] == null) {\r\n\t\t\t\tlevel[key] = /^\\d+$/.test(nextKey) ? [] : {};\r\n\t\t\t}\r\n\r\n\t\t\tlevel = level[key];\r\n\t\t}\r\n\r\n\t\tlevel[lastKey] = value;\r\n\t}\r\n\r\n}","import Cis from \"./cis\";\r\nimport Digital from \"./digital\";\r\nimport { htmlToElement, pascalCase, kebabCase } from \"../utils\";\r\n\r\nexport default class ItemView {\r\n\tstatic defaults = {\r\n\t\tmessages: {},\r\n\t\tname: null,\r\n\t\ttitle: null,\r\n\t\tactions: [],\r\n\t\tonChange: null,\r\n\t}\r\n\r\n\tconstructor(options) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis._wires = [];\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.forgetWires();\r\n\t\tthis.options = {};\r\n\t}\r\n\r\n\tgetMessage(key) {\r\n\t\treturn this.options.messages[key] || key;\r\n\t}\r\n\r\n\tgetTitle() {\r\n\t\treturn this.options.title;\r\n\t}\r\n\r\n\textendOptions(item) {\r\n\t\tthis.options = Object.assign(this.options, {\r\n\t\t\ttitle: item['NAME'],\r\n\t\t});\r\n\t}\r\n\r\n\trender(item, basket) {\r\n\t\tconst columns = Object.keys(basket.COLUMNS);\r\n\r\n\t\tcolumns.unshift('INDEX');\r\n\r\n\t\tthis.forgetWires();\r\n\t\tthis.extendOptions(item);\r\n\r\n\t\tthis.el = htmlToElement(`<tr>\r\n\t\t\t${columns.map((key) => this.renderColumn(item, key)).join('')}\r\n\t\t\t${this.renderActions()}\r\n\t\t</tr>`, 'tbody');\r\n\r\n\t\tthis.setupWires();\r\n\t}\r\n\r\n\tmount(point) {\r\n\t\tpoint.appendChild(this.el);\r\n\t}\r\n\r\n\trenderColumn(item, key) {\r\n\t\tconst method = 'column' + pascalCase(key);\r\n\r\n\t\treturn (\r\n\t\t\tmethod in this\r\n\t\t\t\t? this[method](item, key)\r\n\t\t\t\t: this.columnDefault(item, key)\r\n\t\t);\r\n\t}\r\n\r\n\tcolumnIndex(item, key) {\r\n\t\treturn `<td class=\"for--${kebabCase(key)}\">\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('ID')}\" value=\"${this.value(item, 'ID')}\" />\r\n\t\t\t${this.valueFormatted(item, key)}\r\n\t\t</td>`;\r\n\t}\r\n\r\n\tcolumnCis(item, key) {\r\n\t\tconst cis = new Cis({\r\n\t\t\tmessages: this.options.messages,\r\n\t\t\tname: this.getName('IDENTIFIERS'),\r\n\t\t\trequired: !!this.value(item, 'MARKING_GROUP'),\r\n\t\t\ttotal: this.value(item, 'COUNT'),\r\n\t\t\tinstances: this.value(item, 'INSTANCES'),\r\n\t\t\tinternalInstances: this.value(item, 'INTERNAL_INSTANCES'),\r\n\t\t\tonChange: this.options.onChange,\r\n\t\t});\r\n\r\n\t\tthis.wire(key, cis);\r\n\r\n\t\treturn `<td class=\"for--${kebabCase(key)}\" data-wire=\"${key}\">${cis.build()}</td>`;\r\n\t}\r\n\r\n\tcolumnDigital(item, key) {\r\n\t\tconst digital = new Digital({\r\n\t\t\tmessages: this.options.messages,\r\n\t\t\tname: this.getName('DIGITAL'),\r\n\t\t\ttotal: this.value(item, 'COUNT'),\r\n\t\t\titems: this.value(item, 'DIGITAL'),\r\n\t\t\tonChange: this.options.onChange,\r\n\t\t});\r\n\r\n\t\tthis.wire(key, digital);\r\n\r\n\t\treturn `<td class=\"for--${kebabCase(key)}\" data-wire=\"${key}\">${digital.build()}</td>`;\r\n\t}\r\n\r\n\tcolumnSubsidy(item, key) {\r\n\t\tconst promos = this.value(item, 'PROMOS');\r\n\t\tlet content = this.valueFormatted(item, key);\r\n\r\n\t\tif (promos != null && Array.isArray(promos)) {\r\n\t\t\tcontent += promos.map((promo) => `<div>${promo}</div>`).join('');\r\n\t\t}\r\n\r\n\t\treturn `<td class=\"for--${kebabCase(key)}\">${content}</td>`;\r\n\t}\r\n\r\n\tcolumnCount(item, key) {\r\n\t\tconst value = this.value(item, key);\r\n\t\tconst valueSanitized = parseFloat(value) || '';\r\n\r\n\t\treturn `<td class=\"for--${kebabCase(key)}\">\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('INITIAL_COUNT')}\" value=\"${valueSanitized}\" />\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('COUNT')}\" value=\"${valueSanitized}\" />\r\n\t\t\t${this.valueFormatted(item, key)} ${this.getMessage('ITEM_UNIT')}\r\n\t\t</td>`;\r\n\t}\r\n\r\n\tcolumnDefault(item, key) {\r\n\t\treturn `<td class=\"for--${kebabCase(key)}\">${this.valueFormatted(item, key)}</td>`;\r\n\t}\r\n\r\n\trenderActions() {\r\n\t\treturn '';\r\n\t}\r\n\r\n\twire(key, instance) {\r\n\t\tthis._wires[key] = instance;\r\n\t}\r\n\r\n\tforgetWires() {\r\n\t\tthis._wires = {};\r\n\t}\r\n\r\n\tsetupWires() {\r\n\t\tfor (const [key, instance] of Object.entries(this._wires)) {\r\n\t\t\tconst column = this.el.querySelector(`[data-wire=\"${key}\"]`);\r\n\t\t\tconst element = column.firstElementChild;\r\n\r\n\t\t\tif (!element) { continue; }\r\n\r\n\t\t\tinstance.setup(element);\r\n\t\t}\r\n\t}\r\n\r\n\tcallWires(method, args = []) {\r\n\t\tfor (const [, instance] of Object.entries(this._wires)) {\r\n\t\t\tif (typeof instance[method] !== 'function') { return; }\r\n\r\n\t\t\tinstance[method].apply(instance, args);\r\n\t\t}\r\n\t}\r\n\r\n\tvalueFormatted(item, key) {\r\n\t\tconst formattedKey = key + '_FORMATTED';\r\n\t\tlet result = '';\r\n\r\n\t\tif (item[formattedKey] != null) {\r\n\t\t\tresult = item[formattedKey];\r\n\t\t} else if (item[key] != null) {\r\n\t\t\tresult = item[key];\r\n\t\t}\r\n\r\n\t\treturn result !== '' ? result : '&mdash;';\r\n\t}\r\n\r\n\tvalue(item, key) {\r\n\t\treturn item[key];\r\n\t}\r\n\r\n\tgetName(field) {\r\n\t\treturn this.options.name + '[' + field + ']';\r\n\t}\r\n\r\n\thasAction(type) {\r\n\t\treturn this.options.actions.indexOf(type) !== -1;\r\n\t}\r\n}","import ItemView from \"./itemview\";\r\nimport {kebabCase} from \"../utils\";\r\n\r\nexport default class ItemEdit extends ItemView {\r\n\tstatic ACTION_ITEM = 'item';\r\n\tstatic ACTION_CIS = 'cis';\r\n\tstatic ACTION_DIGITAL = 'digital';\r\n\r\n\tstatic defaults = Object.assign({}, ItemView.defaults)\r\n\r\n\tdestroy() {\r\n\t\tthis.unbind();\r\n\t\tsuper.destroy();\r\n\t}\r\n\r\n\tunbind() {\r\n\t\tthis.handleInputChange(false);\r\n\t\tthis.handleDeleteToggle(false);\r\n\t}\r\n\r\n\thandleInputChange(dir) {\r\n\t\tif (!this.options.onChange) { return; }\r\n\r\n\t\tthis.el.querySelectorAll('input').forEach((input) => {\r\n\t\t\tif (input.name === this.getName('COUNT')) {\r\n\t\t\t\tinput[dir ? 'addEventListener' : 'removeEventListener']('change', this.onCountChange);\r\n\t\t\t}\r\n\r\n\t\t\tinput[dir ? 'addEventListener' : 'removeEventListener']('change', this.options.onChange);\r\n\t\t});\r\n\t}\r\n\r\n\thandleDeleteToggle(dir) {\r\n\t\tconst input = this.el.querySelector('.yamarket-delete-toggle__input');\r\n\r\n\t\tif (!this.hasAction(ItemEdit.ACTION_ITEM) || !input) { return; }\r\n\r\n\t\tinput[dir ? 'addEventListener' : 'removeEventListener']('change', this.onDeleteToggle);\r\n\t}\r\n\r\n\tonCountChange = (evt) => {\r\n\t\tconst count = parseInt(evt.target.value);\r\n\r\n\t\tif (isNaN(count)) { return; }\r\n\r\n\t\tthis.callWires('updateTotal', [count]);\r\n\t}\r\n\r\n\tonDeleteToggle = (evt) => {\r\n\t\tconst isDelete = !!evt.target.checked;\r\n\r\n\t\tthis.el.classList.toggle('is--delete', isDelete);\r\n\t\tthis.disableInput(isDelete);\r\n\t}\r\n\r\n\tdisableInput(dir) {\r\n\t\tthis.el.querySelectorAll('input').forEach((input) => {\r\n\t\t\tif (input.name === this.getName('DELETE')) { return; }\r\n\r\n\t\t\tinput.readonly = dir;\r\n\r\n\t\t\tif (input.classList.contains('ui-ctl-element')) {\r\n\t\t\t\tinput.parentElement.classList.toggle('ui-ctl-disabled', dir);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tgetCountDiff() {\r\n\t\tconst needDelete = this.getInputValue('DELETE');\r\n\t\tconst initialCount = parseInt(this.getInputValue('INITIAL_COUNT'));\r\n\t\tconst count = parseInt(this.getInputValue('COUNT'));\r\n\t\tlet result;\r\n\r\n\t\tif (needDelete) {\r\n\t\t\tresult = initialCount;\r\n\t\t} else {\r\n\t\t\tresult = initialCount - count;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\trender(item, basket) {\r\n\t\tsuper.render(item, basket);\r\n\t\tthis.handleInputChange(true);\r\n\t\tthis.handleDeleteToggle(true);\r\n\t}\r\n\r\n\tcolumnCount(item, key) {\r\n\t\tif (!this.hasAction(ItemEdit.ACTION_ITEM)) { return super.columnCount(item, key); }\r\n\r\n\t\tconst value = this.value(item, key);\r\n\t\tconst valueSanitized = parseFloat(value) || '';\r\n\r\n\t\treturn `<td class=\"for--${kebabCase(key)}\">\r\n\t\t\t<input type=\"hidden\" name=\"${this.getName('INITIAL_COUNT')}\" value=\"${valueSanitized}\" />\r\n\t\t\t<div class=\"ui-ctl ui-ctl-sm ui-ctl-textbox ui-ctl-w100\">\r\n\t\t\t\t<input\r\n\t\t\t\t\tclass=\"ui-ctl-element\"\r\n\t\t\t\t\ttype=\"number\"\r\n\t\t\t\t\tname=\"${this.getName('COUNT')}\"\r\n\t\t\t\t\tvalue=\"${valueSanitized}\"\r\n\t\t\t\t\tmin=\"1\"\r\n\t\t\t\t\tmax=\"${valueSanitized}\"\r\n\t\t\t\t\tstep=\"1\"\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t</td>`;\r\n\t}\r\n\r\n\trenderActions() {\r\n\t\tif (!this.hasAction(ItemEdit.ACTION_ITEM)) { return ''; }\r\n\r\n\t\treturn `<td class=\"for--delete\">\r\n\t\t\t<label class=\"yamarket-delete-toggle\">\r\n\t\t\t\t<input class=\"yamarket-delete-toggle__input\" type=\"checkbox\" name=\"${this.getName('DELETE')}\" value=\"Y\" />\r\n\t\t\t\t<span class=\"yamarket-delete-toggle__icon icon--delete\" title=\"${this.getMessage('ITEM_DELETE')}\">${this.getMessage('ITEM_DELETE')}</span>\r\n\t\t\t\t<span class=\"yamarket-delete-toggle__icon icon--restore\" title=\"${this.getMessage('ITEM_RESTORE')}\">${this.getMessage('ITEM_RESTORE')}</span>\r\n\t\t\t</label>\r\n\t\t</td>`;\r\n\t}\r\n\r\n\tgetInputValue(field) {\r\n\t\tconst input = this.getInput(field);\r\n\t\tlet result;\r\n\r\n\t\tif (input == null) { return null; }\r\n\r\n\t\tif (input.type === 'checkbox') {\r\n\t\t\tresult = input.checked ? input.value : null;\r\n\t\t} else {\r\n\t\t\tresult = input.value;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetInput(field) {\r\n\t\tconst name = this.getName(field);\r\n\r\n\t\treturn this.el.querySelector(`input[name=\"${name}\"]`);\r\n\t}\r\n}","import ReferenceField from \"../reference/field\";\r\nimport ItemView from \"./itemview\";\r\nimport ItemEdit from \"./itemedit\";\r\nimport { htmlToElement, kebabCase } from \"../utils\";\r\nimport './basket.css';\r\n\r\nexport default class Field extends ReferenceField {\r\n\tstatic messages = {}\r\n\tstatic defaults = {\r\n\t\tname: 'BASKET',\r\n\t\tactions: [],\r\n\t}\r\n\r\n\tstatic create(id, settings) {\r\n\t\tconst instance = new Field();\r\n\t\tinstance.initialize(id, settings);\r\n\r\n\t\treturn instance;\r\n\t}\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.items = [];\r\n\t}\r\n\r\n\tcountChanges() {\r\n\t\tconst result = [];\r\n\r\n\t\tfor (const item of this.items) {\r\n\t\t\tif (!(item instanceof ItemEdit)) { continue; }\r\n\r\n\t\t\tconst diff = item.getCountDiff();\r\n\r\n\t\t\tif (diff > 0) {\r\n\t\t\t\tresult.push({\r\n\t\t\t\t\tname: item.getTitle(),\r\n\t\t\t\t\tdiff: diff,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\trender(payload) {\r\n\t\tconst basket = payload['VALUE'];\r\n\t\tconst table = this.renderTable(basket);\r\n\t\tconst body = table.querySelector('tbody');\r\n\r\n\t\tthis.extendOptions(payload);\r\n\r\n\t\tthis.renewItems(basket.ITEMS).forEach((basketItem, index) => {\r\n\t\t\tbasketItem.render(basket.ITEMS[index], basket);\r\n\t\t\tbasketItem.mount(body);\r\n\t\t});\r\n\r\n\t\tthis._wrapper.appendChild(table);\r\n\t}\r\n\r\n\textendOptions(payload) {\r\n\t\tthis.options = Object.assign(this.options, {\r\n\t\t\tactions: payload['ACTIONS'],\r\n\t\t});\r\n\t}\r\n\r\n\trenewItems(payloadItems) {\r\n\t\tthis.destroyItems();\r\n\r\n\t\treturn this.createItems(payloadItems);\r\n\t}\r\n\r\n\tdestroyItems() {\r\n\t\tfor (const item of this.items) {\r\n\t\t\titem.destroy();\r\n\t\t}\r\n\r\n\t\tthis.items = [];\r\n\t}\r\n\r\n\tcreateItems(payloadItems) {\r\n\t\tlet itemIndex = 0;\r\n\r\n\t\tthis.items = [];\r\n\r\n\t\tfor (const payloadItem of payloadItems) {\r\n\t\t\tthis.items.push(this.createItem(itemIndex));\r\n\t\t\t++itemIndex;\r\n\t\t}\r\n\r\n\t\treturn this.items;\r\n\t}\r\n\r\n\tcreateItem(index) {\r\n\t\tconst options = {\r\n\t\t\tmessages: Field.messages,\r\n\t\t\tname: `${this.options.name}[${index}]`,\r\n\t\t\tactions: this.options.actions,\r\n\t\t\tonChange: this.hasAction(ItemEdit.ACTION_CIS) || this.hasAction(ItemEdit.ACTION_DIGITAL)\r\n\t\t\t\t? () => {\r\n\t\t\t\t\tif (this._mode !== BX.UI.EntityEditorMode.edit) {\r\n\t\t\t\t\t\tthis._mode = BX.UI.EntityEditorMode.edit;\r\n\t\t\t\t\t\tthis._editor.showToolPanel();\r\n\t\t\t\t\t\tthis._editor.registerActiveControl(this);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis._changeHandler();\r\n\t\t\t\t}\r\n\t\t\t\t: this._changeHandler,\r\n\t\t};\r\n\r\n\t\tif (this._mode === BX.UI.EntityEditorMode.edit) {\r\n\t\t\treturn new ItemEdit(options);\r\n\t\t}\r\n\r\n\t\treturn new ItemView(options);\r\n\t}\r\n\r\n\trenderTable(basket) {\r\n\t\treturn htmlToElement(`<div class=\"yamarket-basket\">\r\n\t\t\t<div class=\"yamarket-basket-table-viewport\">\r\n\t\t\t\t<table class=\"yamarket-basket-table\">\r\n\t\t\t\t\t${this.renderHeader(basket)}\r\n\t\t\t\t\t<tbody></tbody>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t\t${this.renderSummary(basket)}\r\n\t\t</div>`);\r\n\t}\r\n\r\n\trenderHeader(basket) {\r\n\t\treturn `<thead>\r\n\t\t\t<tr>\r\n\t\t\t\t<td class=\"for--index\">&numero;</td>\r\n\t\t\t\t${Object.keys(basket.COLUMNS)\r\n\t\t\t\t\t.map((key) => `<td class=\"for--${kebabCase(key)}\">${this.columnTitle(basket, key)}</td>`)\r\n\t\t\t\t\t.join('')}\r\n\t\t\t\t${this.isInEditMode() && this.hasAction(ItemEdit.ACTION_ITEM) ? '<td class=\"for--delete\">&nbsp;</td>' : ''}\r\n\t\t\t</tr>\r\n\t\t</thead>`;\r\n\t}\r\n\r\n\tcolumnTitle(basket, key) {\r\n\t\tconst langKey = 'HEADER_' + key;\r\n\t\tconst lang = this.getMessage(langKey);\r\n\r\n\t\treturn lang !== langKey ? lang : basket.COLUMNS[key];\r\n\t}\r\n\r\n\trenderSummary(basket) {\r\n\t\tif (basket.SUMMARY.length === 0) { return ''; }\r\n\r\n\t\treturn `<div class=\"yamarket-basket-summary\">\r\n\t\t\t${basket.SUMMARY\r\n\t\t\t\t.map((item) => {\r\n\t\t\t\t\treturn `<div class=\"yamarket-basket-summary__row\">\r\n\t\t\t\t\t\t<div class=\"yamarket-basket-summary__label\">${item['NAME']}:</div>\r\n\t\t\t\t\t\t<div class=\"yamarket-basket-summary__value\">${item['VALUE']}</div>\r\n\t\t\t\t\t</div>`;\r\n\t\t\t\t})\r\n\t\t\t\t.join('')}\r\n\t\t</div>`;\r\n\t}\r\n\r\n\thasAction(type) {\r\n\t\treturn this.options.actions.indexOf(type) !== -1;\r\n\t}\r\n}","import ReferenceField from \"../reference/field\";\r\nimport { htmlToElement, copyValues } from \"../utils\";\r\n\r\nexport default class Field extends ReferenceField {\r\n\tstatic messages = {}\r\n\tstatic defaults = {\r\n\t\tname: 'BASKET_CONFIRM',\r\n\t\treasons: [],\r\n\t}\r\n\r\n\tstatic create(id, settings) {\r\n\t\tconst instance = new Field();\r\n\t\tinstance.initialize(id, settings);\r\n\r\n\t\treturn instance;\r\n\t}\r\n\r\n\tvalidate(validator) {\r\n\t\tconst basket = this._parent.getChildById('BASKET');\r\n\r\n\t\tif (basket == null) { return; }\r\n\r\n\t\tconst countChanges = basket.countChanges();\r\n\r\n\t\tif (countChanges.length === 0) { return; }\r\n\r\n\t\treturn this.showDialog(countChanges, validator);\r\n\t}\r\n\r\n\tshowDialog(countChanges, validator) {\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tconst messageBox = BX.UI.Dialogs.MessageBox.create({\r\n\t\t\t\ttitle: this.getMessage('MODAL_TITLE'),\r\n\t\t\t\tmessage: this.dialogBody(countChanges),\r\n\t\t\t});\r\n\r\n\t\t\tmessageBox.setButtons([\r\n\t\t\t\tnew BX.UI.SendButton({\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: this.onSendClick.bind(this, messageBox, resolve),\r\n\t\t\t\t\t}\r\n\t\t\t\t}),\r\n\t\t\t\tnew BX.UI.CancelButton({\r\n\t\t\t\t\tevents: {\r\n\t\t\t\t\t\tclick: this.onCancelClick.bind(this, messageBox, validator, resolve),\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t]);\r\n\r\n\t\t\tmessageBox.show();\r\n\t\t});\r\n\t}\r\n\r\n\tdialogBody(countChanges) {\r\n\t\treturn `\r\n\t\t\t<div class=\"ui-form-row\">\r\n\t\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('REASON')}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t\t${this.reasonControl()}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"ui-form-row\">\r\n\t\t\t\t<div class=\"ui-form-label\">\r\n\t\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('PRODUCTS')}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"ui-form-content\">\r\n\t\t\t\t\t${this.productsControl(countChanges)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"ui-alert ui-alert-warning\">${this.getMessage('FORM_INTRO')}</div>\r\n\t\t`;\r\n\t}\r\n\r\n\treasonControl() {\r\n\t\treturn `<div class=\"ui-ctl ui-ctl-after-icon ui-ctl-dropdown ui-ctl-w100\">\r\n\t\t\t<div class=\"ui-ctl-after ui-ctl-icon-angle\"></div>\r\n\t\t\t<select class=\"ui-ctl-element\" name=\"${this.options.name}[REASON]\">\r\n\t\t\t\t${this.options.reasons.map((option) => `<option value=\"${option['ID']}\">${option['VALUE']}</option>`).join('')}\r\n\t\t\t</select>\r\n\t\t</div>`\r\n\t}\r\n\r\n\tproductsControl(changes) {\r\n\t\treturn changes\r\n\t\t\t.map((change) => {\r\n\t\t\t\treturn this.getMessage('ITEM_CHANGE', {\r\n\t\t\t\t\tNAME: change.name,\r\n\t\t\t\t\tCOUNT: change.diff,\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.join('<hr />');\r\n\t}\r\n\r\n\tonSendClick(messageBox, resolve) {\r\n\t\tcopyValues(messageBox.popupWindow.contentContainer, this.el);\r\n\t\tmessageBox.close();\r\n\t\tresolve();\r\n\t}\r\n\r\n\tonCancelClick(messageBox, validator, resolve) {\r\n\t\tconst error = BX.UI.EntityValidationError.create({\r\n\t\t\tfield: this,\r\n\t\t});\r\n\r\n\t\tvalidator.addError(error);\r\n\t\tmessageBox.close();\r\n\t\tresolve();\r\n\t}\r\n\r\n\trender(payload) {\r\n\t\tthis.extendOptions(payload);\r\n\r\n\t\tthis.el = htmlToElement(`<div class=\"ui-helper-hidden\">\r\n\t\t\t<input type=\"hidden\" name=\"${this.options.name}[REASON]\" value=\"\" />\r\n\t\t</div>`)\r\n\r\n\t\tthis._wrapper.appendChild(this.el);\r\n\t}\r\n\r\n\textendOptions(payload) {\r\n\t\tthis.options = Object.assign(this.options, {\r\n\t\t\treasons: payload['ITEMS_CHANGE_REASON'],\r\n\t\t});\r\n\t}\r\n}","import { htmlToElement } from \"../utils\";\r\nimport './box.css';\r\n\r\nexport default class ItemView {\r\n\tstatic defaults = {\r\n\t\tname: null,\r\n\t\tmessages: {},\r\n\t\tboxProperties: {},\r\n\t\tboxDimensions: {},\r\n\t\tuseDimensions: false,\r\n\t\tfulfilmentBase: null,\r\n\t\tonChange: null,\r\n\t}\r\n\r\n\tconstructor(options) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\tgetMessage(key) {\r\n\t\treturn this.options.messages[key] || key;\r\n\t}\r\n\r\n\ttoggleUseDimensions(enabled) {\r\n\t\tthis.options.useDimensions = enabled;\r\n\t}\r\n\r\n\trender(value) {\r\n\t\tthis.el = htmlToElement(`<div class=\"yamarket-box\">\r\n\t\t\t${this.buildDefined(value)}\r\n\t\t\t${this.buildHeader(value)}\r\n\t\t\t${this.buildBody(value)}\r\n\t\t</div>`);\r\n\t}\r\n\r\n\tbuildDefined(value) {\r\n\t\tconst keys = [\r\n\t\t\t'FULFILMENT_ID',\r\n\t\t];\r\n\t\tlet result = '';\r\n\r\n\t\tfor (const key of keys) {\r\n\t\t\tresult += `<input type=\"hidden\" name=\"${this.options.name}[${key}]\" value=\"${BX.util.htmlspecialchars(value[key] || '')}\" />`;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tbuildSizes(value) {\r\n\t\tif (!this.options.useDimensions) { return ''; }\r\n\r\n\t\treturn `${Object.keys(this.options.boxDimensions).map((name) => {\r\n\t\t\tconst inputName = this.getName('DIMENSIONS') + `[${name}]`;\r\n\t\t\tconst inputValue = value?.DIMENSIONS?.[name]?.['VALUE'] || '';\r\n\t\t\t\r\n\t\t\tif (inputValue === '') { return ''; }\r\n\r\n\t\t\treturn `<input type=\"hidden\" name=\"${inputName}\" value=\"${BX.util.htmlspecialchars(inputValue)}\" data-name=\"${name}\" />`;\r\n\t\t}).join('')}`;\r\n\t}\r\n\r\n\tbuildHeader(value) {\r\n\t\treturn `<div class=\"yamarket-box__header\">\r\n\t\t\t<div class=\"yamarket-box__title\">\r\n\t\t\t\t${this.getMessage('BOX')}\r\n\t\t\t\t&numero;${value['NUMBER']}\r\n\t\t\t</div>\r\n\t\t\t${this.buildProperties(value)}\r\n\t\t\t${this.buildActions(value)}\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tbuildProperties(value) {\r\n\t\tconst disabled = this.disabledProperties();\r\n\r\n\t\treturn `<div class=\"yamarket-box__properties\">\r\n\t\t\t${Object.entries(this.options.boxProperties).map(([name,property]) => {\r\n\t\t\t\tconst propertyValue = value?.PROPERTIES?.[name] || '';\r\n\t\t\t\t\r\n\t\t\t\tif (propertyValue === '' || disabled.indexOf(name) !== -1) { return ''; }\r\n\t\t\t\t\r\n\t\t\t\treturn `<div class=\"yamarket-box__property\">\r\n\t\t\t\t\t${property['NAME']}: ${propertyValue} ${property['UNIT_FORMATTED'] || ''}\r\n\t\t\t\t</div>`;\r\n\t\t\t}).join('')}\r\n\t\t</div>`\r\n\t}\r\n\r\n\tdisabledProperties() {\r\n\t\treturn [];\r\n\t}\r\n\r\n\tbuildActions(value) {\r\n\t\treturn '';\r\n\t}\r\n\r\n\tbuildBody(value) {\r\n\t\treturn this.buildSizes(value);\r\n\t}\r\n\r\n\tmount(point, after) {\r\n\t\tif (after != null) {\r\n\t\t\tafter.after(this.el);\r\n\t\t} else {\r\n\t\t\tpoint.appendChild(this.el);\r\n\t\t}\r\n\t}\r\n\r\n\tupdateNumber(number) {\r\n\t\tconst title = this.el.querySelector('.yamarket-box__title');\r\n\t\tconst fulfilmentId = this.el.querySelector('input[name$=\"[FULFILMENT_ID]\"]');\r\n\r\n\t\ttitle.innerHTML = `${this.getMessage('BOX')} &numero;${number}`;\r\n\t\tfulfilmentId.value = this.options.fulfilmentBase + number;\r\n\t}\r\n\r\n\tgetName(field) {\r\n\t\treturn this.options.name + '[' + field + ']';\r\n\t}\r\n\r\n\tfireChange() {\r\n\t\tthis.options.onChange && this.options.onChange();\r\n\t}\r\n}","import ItemView from \"./itemview\";\r\nimport './box.css';\r\n\r\nexport default class ItemEdit extends ItemView {\r\n\r\n\tdestroy() {\r\n\t\tthis.unbind();\r\n\t}\r\n\r\n\tunbind() {\r\n\t\tthis.handleInputChange(false);\r\n\t\tthis.handleDeleteClick(false);\r\n\t}\r\n\r\n\thandleInputChange(dir) {\r\n\t\tif (!this.options.onChange) { return; }\r\n\r\n\t\tthis.el.querySelectorAll('input').forEach((input) => {\r\n\t\t\tif (input.type === 'hidden') { return; }\r\n\r\n\t\t\tinput[dir ? 'addEventListener' : 'removeEventListener']('change', this.options.onChange);\r\n\t\t});\r\n\t}\r\n\r\n\thandleDeleteClick(dir) {\r\n\t\tconst button = this.el.querySelector('.yamarket-box__delete');\r\n\r\n\t\tif (!button) { return; }\r\n\r\n\t\tbutton[dir ? 'addEventListener' : 'removeEventListener']('click', this.onDeleteClick);\r\n\t}\r\n\r\n\tonDeleteClick = (evt) => {\r\n\t\tthis.remove();\r\n\t\tevt.preventDefault();\r\n\t}\r\n\r\n\ttoggleUseDimensions(enabled) {\r\n\t\tsuper.toggleUseDimensions(enabled);\r\n\r\n\t\tif (this.el == null) { return; }\r\n\r\n\t\tconst body = this.el.querySelector('.yamarket-box__body');\r\n\r\n\t\tif (body == null) { return; }\r\n\r\n\t\tif (enabled) {\r\n\t\t\tbody.classList.remove('is--disabled');\r\n\t\t} else {\r\n\t\t\tbody.classList.add('is--disabled');\r\n\t\t}\r\n\t}\r\n\r\n\tremove() {\r\n\t\tthis.fireRemove();\r\n\t\tthis.destroy();\r\n\t\tthis.el.remove();\r\n\t}\r\n\r\n\tfireRemove() {\r\n\t\tthis.el.dispatchEvent(new CustomEvent('yamarketBoxDelete', {\r\n\t\t\tdetail: {\r\n\t\t\t\titem: this,\r\n\t\t\t},\r\n\t\t\tbubbles: true,\r\n\t\t}));\r\n\t}\r\n\r\n\trender(value) {\r\n\t\tsuper.render(value);\r\n\t\tthis.handleInputChange(true);\r\n\t\tthis.handleDeleteClick(true);\r\n\t}\r\n\r\n\tdisabledProperties() {\r\n\t\treturn [\r\n\t\t\t'SIZE',\r\n\t\t\t'WEIGHT',\r\n\t\t];\r\n\t}\r\n\r\n\tbuildActions(value) {\r\n\t\treturn `<div class=\"yamarket-box__actions\">\r\n\t\t\t<span class=\"yamarket-box__delete ui-entity-editor-header-edit-lnk\">${this.getMessage('BOX_DELETE')}</span>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tbuildBody(value) {\r\n\t\treturn `<div class=\"yamarket-box__body ${this.options.useDimensions ? '' : 'is--disabled'}\">\r\n\t\t\t${this.buildSizes(value)}\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tbuildSizes(value) {\r\n\t\treturn `<div class=\"yamarket-box__sizes\">\r\n\t\t\t${Object.entries(this.options.boxDimensions).map(([name, property]) => {\r\n\t\t\t\tconst inputName = this.getName('DIMENSIONS') + `[${name}]`;\r\n\t\t\t\tconst inputValue = value?.DIMENSIONS?.[name]?.['VALUE'] || '';\r\n\t\r\n\t\t\t\treturn `<div class=\"yamarket-box__size\">\r\n\t\t\t\t\t<div class=\"ui-entity-editor-content-block ui-entity-editor-field-text\">\r\n\t\t\t\t\t\t<div class=\"ui-entity-editor-block-title ui-entity-widget-content-block-title-edit\">\r\n\t\t\t\t            <label class=\"ui-entity-editor-block-title-text\">${property['NAME']}${property['UNIT_FORMATTED'] ? ', ' + property['UNIT_FORMATTED'] : ''}</label>\r\n\t\t\t\t        </div>\r\n\t\t\t\t        <div class=\"ui-ctl ui-ctl-textbox ui-ctl-w100\">\r\n\t\t\t\t            <input class=\"ui-ctl-element\" type=\"text\" name=\"${inputName}\" value=\"${BX.util.htmlspecialchars(inputValue)}\" size=\"6\" data-name=\"${name}\" />\r\n\t\t\t\t        </div>\r\n\t\t\t       </div>\r\n\t\t\t\t</div>`;\r\n\t\t\t}).join('')}\r\n\t\t</div>`;\r\n\t}\r\n}","import ItemView from './itemview';\r\nimport ItemEdit from './itemedit';\r\nimport { htmlToElement } from \"../utils\";\r\n\r\nexport default class Collection {\r\n\tstatic defaults = {\r\n\t\tname: null,\r\n\t\tmessages: {},\r\n\t\tboxProperties: {},\r\n\t\tboxDimensions: {},\r\n\t\tuseDimensions: false,\r\n\t\tfulfilmentBase: null,\r\n\t\tonChange: null,\r\n\t}\r\n\r\n\tconstructor(options) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\tgetMessage(key) {\r\n\t\treturn this.options.messages[key] || key;\r\n\t}\r\n\r\n\thandleItemRemove() {\r\n\t\tthis.el.addEventListener('yamarketBoxDelete', this.onItemRemove);\r\n\t}\r\n\r\n\thandleAddClick(button) {\r\n\t\tbutton.addEventListener('click', this.onAddClick);\r\n\t}\r\n\r\n\tonItemRemove = (evt) => {\r\n\t\tconst item = evt.detail.item;\r\n\r\n\t\tthis.releaseItem(item);\r\n\t\tthis.renewNumber();\r\n\t\tthis.fireChange();\r\n\t}\r\n\r\n\tonAddClick = (evt) => {\r\n\t\tthis.addItem();\r\n\t\tthis.fireChange();\r\n\r\n\t\tevt.preventDefault();\r\n\t}\r\n\r\n\ttoggleUseDimensions(enabled) {\r\n\t\tthis.options.useDimensions = enabled;\r\n\r\n\t\tif (this.items == null) { return; }\r\n\r\n\t\tfor (const item of this.items) {\r\n\t\t\titem.toggleUseDimensions(enabled);\r\n\t\t}\r\n\t}\r\n\r\n\trender(value) {\r\n\t\tthis.renderSelf();\r\n\t\tthis.renderItems(value);\r\n\t\tthis.renderAddButton();\r\n\t}\r\n\r\n\trenderSelf() {\r\n\t\tthis.el = htmlToElement(`<div class=\"yamarket-boxes\"></div>`);\r\n\t}\r\n\r\n\trenderItems(value) {\r\n\t\tconst items = [];\r\n\t\tlet index = 0;\r\n\r\n\t\tfor (const one of value) {\r\n\t\t\tconst box = this.createItem(index);\r\n\r\n\t\t\tbox.render(one);\r\n\t\t\tbox.mount(this.el);\r\n\r\n\t\t\titems.push(box);\r\n\r\n\t\t\t++index;\r\n\t\t}\r\n\r\n\t\tthis.items = items;\r\n\t\tthis.nextIndex = index;\r\n\r\n\t\tthis.handleItemRemove();\r\n\t}\r\n\r\n\tcreateItem(index) {\r\n\t\tconst options = {\r\n\t\t\tname: this.options.name + `[${index}]`,\r\n\t\t\tmessages: this.options.messages,\r\n\t\t\tboxProperties: this.options.boxProperties,\r\n\t\t\tboxDimensions: this.options.boxDimensions,\r\n\t\t\tuseDimensions: this.options.useDimensions,\r\n\t\t\tfulfilmentBase: this.options.fulfilmentBase,\r\n\t\t\tonChange: this.options.onChange,\r\n\t\t};\r\n\r\n\t\tif (this.options.mode === BX.UI.EntityEditorMode.edit) {\r\n\t\t\treturn new ItemEdit(options);\r\n\t\t}\r\n\r\n\t\treturn new ItemView(options);\r\n\t}\r\n\r\n\treleaseItem(item) {\r\n\t\tconst index = this.items.indexOf(item);\r\n\r\n\t\tif (index === -1) { return; }\r\n\r\n\t\tthis.items.splice(index, 1);\r\n\t}\r\n\r\n\trenewNumber() {\r\n\t\tlet num = 1;\r\n\r\n\t\tfor (const box of this.items) {\r\n\t\t\tbox.updateNumber(num);\r\n\t\t\t++num;\r\n\t\t}\r\n\t}\r\n\r\n\taddItem() {\r\n\t\tconst number = this.items.length + 1;\r\n\t\tconst box = this.createItem(this.nextIndex);\r\n\t\tconst last = this.items[this.items.length - 1]?.el;\r\n\r\n\t\tbox.render({\r\n\t\t\t'FULFILMENT_ID': this.options.fulfilmentBase + number,\r\n\t\t\t'NUMBER': number,\r\n\t\t});\r\n\t\tbox.mount(this.el, last);\r\n\r\n\t\tthis.items.push(box);\r\n\t\t++this.nextIndex;\r\n\t}\r\n\r\n\trenderAddButton() {\r\n\t\tif (this.options.mode !== BX.UI.EntityEditorMode.edit) { return ''; }\r\n\r\n\t\tconst addButton = htmlToElement(`<span class=\"yamarket-boxes__add ui-entity-editor-content-create-lnk\">${this.getMessage('BOX_ADD')}</span>`);\r\n\r\n\t\tthis.el.appendChild(addButton);\r\n\t\tthis.handleAddClick(addButton);\r\n\t}\r\n\r\n\tfireChange() {\r\n\t\tthis.options.onChange && this.options.onChange();\r\n\t}\r\n\r\n\tmount(point) {\r\n\t\tpoint.appendChild(this.el);\r\n\t}\r\n}","import ReferenceField from \"../reference/field\";\r\nimport BoxCollection from \"../box/collection\";\r\nimport {htmlToElement} from \"../utils\";\r\n\r\nexport default class Field extends ReferenceField {\r\n\tstatic messages = {}\r\n\tstatic defaults = {\r\n\t\tname: 'SHIPMENT',\r\n\t\tactions: [],\r\n\t}\r\n\r\n\tstatic create(id, settings) {\r\n\t\tconst instance = new Field();\r\n\t\tinstance.initialize(id, settings);\r\n\r\n\t\treturn instance;\r\n\t}\r\n\r\n\tinitialize(id, settings) {\r\n\t\tsuper.initialize(id, settings);\r\n\t\tthis.handleTitleActions(true);\r\n\t}\r\n\r\n\trelease() {\r\n\t\tthis.handleTitleActions(false);\r\n\t\tsuper.release();\r\n\t}\r\n\r\n\thandleTitleActions(dir) {\r\n\t\tBX[dir ? 'addCustomEvent' : 'removeCustomEvent'](window, 'BX.UI.EntityEditorSection:onLayout', this.onTitleActions);\r\n\t}\r\n\r\n\thandleUseDimensionsChange(node, dir) {\r\n\t\tnode[dir ? 'addEventListener' : 'removeEventListener']('change', this.onUseDimensionsChange);\r\n\t}\r\n\r\n\tonTitleActions = (field, context) => {\r\n\t\tif (field !== this.getParent()) { return; }\r\n\r\n\t\tconst useDimensionsNode = field.isInEditMode()\r\n\t\t\t? this.renderUseDimensions(this.useDimensions)\r\n\t\t\t: this.definedUseDimensions(this.useDimensions);\r\n\r\n\t\tcontext.customNodes.push(useDimensionsNode);\r\n\t}\r\n\r\n\tonUseDimensionsChange = (evt) => {\r\n\t\tconst enabled = evt.target.checked;\r\n\r\n\t\tthis.toggleUseDimensions(enabled);\r\n\t\tthis.markAsChanged();\r\n\t}\r\n\r\n\trender(payload) {\r\n\t\tthis.syncUseDimensions(payload['USE_DIMENSIONS']);\r\n\t\tthis.renderShipments(payload['VALUE'], {\r\n\t\t\tfulfilmentBase: payload['FULFILMENT_BASE'],\r\n\t\t\tboxProperties: payload['BOX_PROPERTIES'],\r\n\t\t\tboxDimensions: payload['BOX_DIMENSIONS'],\r\n\t\t\tuseDimensions: payload['USE_DIMENSIONS'],\r\n\t\t});\r\n\t}\r\n\r\n\tdefinedUseDimensions(enabled = false) {\r\n\t\treturn htmlToElement(`<input type=\"hidden\" name=\"USE_DIMENSIONS\" value=\"${enabled ? 'Y' : 'N'}\" />`);\r\n\t}\r\n\r\n\trenderUseDimensions(enabled = false) {\r\n\t\tconst node = htmlToElement(`<div class=\"ui-entity-editor-field-checkbox\">\r\n\t\t\t<input type=\"hidden\" name=\"USE_DIMENSIONS\" value=\"N\" />\r\n\t\t\t<label class=\"ui-ctl ui-ctl-xs ui-ctl-wa ui-ctl-checkbox yamarket-boxes-use-dimensions\">\r\n\t\t\t\t<input class=\"ui-ctl-element\" type=\"checkbox\" name=\"USE_DIMENSIONS\" value=\"Y\" ${enabled ? 'checked' : ''} />\r\n\t\t\t\t<div class=\"ui-ctl-label-text\">${this.getMessage('USE_DIMENSIONS')}</div>\r\n\t\t\t</label>\r\n\t\t</div>`);\r\n\t\tconst checkbox = node.querySelector('input[type=\"checkbox\"]');\r\n\r\n\t\tthis.handleUseDimensionsChange(checkbox, true);\r\n\r\n\t\treturn node;\r\n\t}\r\n\r\n\tsyncUseDimensions(enabled) {\r\n\t\tthis.useDimensions = enabled;\r\n\t}\r\n\r\n\ttoggleUseDimensions(enabled) {\r\n\t\tif (this.shipmentBoxes == null) { return; }\r\n\r\n\t\tfor (const boxCollection of this.shipmentBoxes) {\r\n\t\t\tboxCollection.toggleUseDimensions(enabled);\r\n\t\t}\r\n\t}\r\n\r\n\trenderShipmentTitle(shipment) {\r\n\t\tconst html = `<div class=\"ui-entity-editor-block-title\">\r\n\t\t\t<span class=\"ui-entity-editor-block-title-text\">${this.getMessage('SHIPMENT', { 'ID': shipment['ID'] })}</span>\r\n\t\t</div>`;\r\n\r\n\t\tthis._wrapper.insertAdjacentHTML('beforeend', html);\r\n\t}\r\n\r\n\trenderShipments(shipmentCollection, options) {\r\n\t\tthis.shipmentBoxes = [];\r\n\r\n\t\tif (!Array.isArray(shipmentCollection)) { shipmentCollection = []; }\r\n\r\n\t\tconst hasFew = shipmentCollection.length > 1;\r\n\t\tlet index = 0;\r\n\r\n\t\tfor (const shipment of shipmentCollection) {\r\n\t\t\tif (hasFew) {\r\n\t\t\t\tthis.renderShipmentTitle(shipment);\r\n\t\t\t}\r\n\r\n\t\t\tthis.renderShipment(shipment, Object.assign(options, {\r\n\t\t\t\tname: `${this.options.name}[${index}]`,\r\n\t\t\t}));\r\n\r\n\t\t\t++index;\r\n\t\t}\r\n\t}\r\n\r\n\trenderShipment(shipment, options) {\r\n\t\tthis.renderShipmentDefined(shipment, options);\r\n\t\tthis.renderBoxCollection(shipment['BOX'], options);\r\n\t}\r\n\r\n\trenderShipmentDefined(shipment, options) {\r\n\t\tconst keys = [\r\n\t\t\t'ID',\r\n\t\t];\r\n\r\n\t\tfor (const key of keys) {\r\n\t\t\tif (shipment[key] == null) { continue; }\r\n\r\n\t\t\tthis._wrapper.insertAdjacentHTML(\r\n\t\t\t\t'afterbegin',\r\n\t\t\t\t`<input type=\"hidden\" name=\"${options.name}[${key}]\" value=\"${shipment[key]}\" />`\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\trenderBoxCollection(shipment, options) {\r\n\t\tconst boxCollection = new BoxCollection(Object.assign(options, {\r\n\t\t\tmessages: Field.messages,\r\n\t\t\tmode: this._mode,\r\n\t\t\tname: options.name + '[BOX]',\r\n\t\t\tonChange: this._changeHandler,\r\n\t\t}));\r\n\r\n\t\tboxCollection.render(shipment);\r\n\t\tboxCollection.mount(this._wrapper);\r\n\r\n\t\tthis.shipmentBoxes.push(boxCollection);\r\n\t}\r\n}\r\n","import ReferenceField from \"../reference/field\";\r\nimport {htmlToElement} from \"../utils\";\r\n\r\nexport default class Field extends ReferenceField {\r\n\tstatic messages = {}\r\n\tstatic defaults = {\r\n\t\tbroadcastElement: '#YAMARKET_ORDER_VIEW',\r\n\t}\r\n\r\n\tstatic create(id, settings) {\r\n\t\tconst instance = new Field();\r\n\t\tinstance.initialize(id, settings);\r\n\r\n\t\treturn instance;\r\n\t}\r\n\r\n\tuseTitle() {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tbind() {\r\n\t\tthis.handleActivityEnd(true);\r\n\t}\r\n\r\n\tunbind() {\r\n\t\tthis.handleActivityEnd(false);\r\n\t}\r\n\r\n\thandleActivityEnd(dir) {\r\n\t\tif (this._activityType == null) { return; }\r\n\r\n\t\tconst broadcast = this.getElement('broadcast');\r\n\r\n\t\tBX[dir ? 'addCustomEvent' : 'removeCustomEvent'](broadcast, 'yamarketActivitySubmitEnd', this.onActivityEnd);\r\n\t}\r\n\r\n\tonActivityEnd = (type) => {\r\n\t\tif (!this.isMatchActivity(type)) { return; }\r\n\r\n\t\tthis._editor.reload();\r\n\t}\r\n\r\n\tisMatchActivity(type) {\r\n\t\tif (type == null) { return false; }\r\n\r\n\t\treturn (type === this._activityType || type.indexOf(this._activityType + '|') === 0);\r\n\t}\r\n\r\n\tforget() {\r\n\t\tif (!this.el) { return; }\r\n\r\n\t\tthis.unbind();\r\n\t}\r\n\r\n\trender(payload) {\r\n\t\tconst html = this.build(payload);\r\n\r\n\t\tthis._activityType = payload?.ACTIVITY_ACTION?.TYPE;\r\n\r\n\t\tthis.el = htmlToElement(html);\r\n\t\tthis.bind();\r\n\r\n\t\tthis._wrapper.appendChild(this.el);\r\n\t}\r\n\r\n\tbuild(payload) {\r\n\t\tconst activity = payload['ACTIVITY_ACTION'];\r\n\r\n\t\treturn `<div class=\"ui-entity-editor-content-block\">\r\n\t\t\t<div class=\"ui-entity-editor-content-block-text\">\r\n\t\t\t\t${BX.util.htmlspecialchars(payload['VALUE'])}\r\n\t\t\t\t${activity ? this.buildActivity(activity, payload) : ''}\r\n\t\t\t</div>\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tbuildActivity(activity, property) {\r\n\t\tconst title = activity['TEXT'] !== property['NAME'] ? activity['TEXT'] : this.getMessage('ACTIVITY_APPLY');\r\n\t\tconst onclick = this.makeActivityMethod(activity);\r\n\r\n\t\treturn `<small>\r\n\t\t\t<a href=\"#\" onclick='${onclick}; return false'>${title}</a>\r\n\t\t</small>`;\r\n\t}\r\n\r\n\tmakeActivityMethod(activity) {\r\n\t\tlet result;\r\n\r\n\t\tif (activity['MENU'] != null) {\r\n\t\t\tconst items = activity['MENU'].map((action) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\ttext: action['TEXT'],\r\n\t\t\t\t\tonclick: action['METHOD'],\r\n\t\t\t\t};\r\n\t\t\t});\r\n\r\n\t\t\tresult = `BX.PopupMenu.show(\"${activity['TYPE']}\", this, ${JSON.stringify(items)}, { angle: { offset: 50 } })`;\r\n\t\t} else {\r\n\t\t\tresult = activity['METHOD'];\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n}","import ReferenceField from \"../reference/field\";\r\nimport { htmlToElement } from \"../utils\";\r\nimport './print.css';\r\n\r\nexport default class Field extends ReferenceField {\r\n\tstatic messages = {}\r\n\tstatic defaults = {\r\n\t\turl: null,\r\n\t\twidth: 400,\r\n\t\theight: 300,\r\n\t\titems: [],\r\n\t}\r\n\r\n\tstatic create(id, settings) {\r\n\t\tconst instance = new Field();\r\n\t\tinstance.initialize(id, settings);\r\n\r\n\t\treturn instance;\r\n\t}\r\n\r\n\tbindDocumentsClick() {\r\n\t\tthis._wrapper.querySelectorAll('.yamarket-print__link').forEach((link) => {\r\n\t\t\tlink.addEventListener('click', this.onDocumentClick);\r\n\t\t});\r\n\t}\r\n\r\n\tonDocumentClick = (evt) => {\r\n\t\tconst link = evt.currentTarget;\r\n\t\tconst type = link.dataset.type;\r\n\t\tconst item = this.getItem(type);\r\n\t\tconst url = this.buildDocumentUrl(type);\r\n\t\tconst dialog = this.createDialog(url, item);\r\n\r\n\t\tdialog.Show();\r\n\r\n\t\tevt.preventDefault();\r\n\t}\r\n\r\n\tgetItem(type) {\r\n\t\tlet result;\r\n\r\n\t\tfor (const document of this.options.items) {\r\n\t\t\tif (document['TYPE'] === type) {\r\n\t\t\t\tresult = document;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tbuildDocumentUrl(type) {\r\n\t\tconst url = this.options.url;\r\n\r\n\t\treturn (\r\n\t\t\turl\r\n\t\t\t+ (url.indexOf('?') === -1 ? '?' : '&')\r\n\t\t\t+ 'type=' + type\r\n\t\t);\r\n\t}\r\n\r\n\tcreateDialog(url, item) {\r\n\t\treturn new BX.YandexMarket.PrintDialog({\r\n\t\t\ttitle: item.DIALOG_TITLE || item.TITLE,\r\n\t\t\tcontent_url: url,\r\n\t\t\twidth: item.WIDTH || this.options.width,\r\n\t\t\theight: item.HEIGHT || this.options.height,\r\n\t\t\tbuttons: [\r\n\t\t\t\tBX.YandexMarket.PrintDialog.btnSave,\r\n\t\t\t\tBX.YandexMarket.PrintDialog.btnCancel\r\n\t\t\t]\r\n\t\t});\r\n\t}\r\n\r\n\trender(value) {\r\n\t\tthis.extendOptions(value);\r\n\r\n\t\tthis.renderIntro();\r\n\t\tthis.renderDocuments(value['ITEMS']);\r\n\r\n\t\tthis.bindDocumentsClick();\r\n\t}\r\n\r\n\textendOptions(value) {\r\n\t\tthis.options = Object.assign(this.options, {\r\n\t\t\turl: value['URL'],\r\n\t\t\titems: value['ITEMS'],\r\n\t\t});\r\n\t}\r\n\r\n\trenderIntro() {\r\n\t\tconst element = htmlToElement(`<p class=\"yamarket-print__intro\">${this.getMessage('INTRO')}</p>`);\r\n\r\n\t\tthis._wrapper.appendChild(element);\r\n\t}\r\n\r\n\trenderDocuments(items) {\r\n\t\tif (!Array.isArray(items)) { return; }\r\n\r\n\t\tconst element = htmlToElement(`<ul class=\"yamarket-print__documents\">\r\n\t\t\t${items.map((document) => `<li class=\"yamarket-print__document\">\r\n\t\t\t\t<a class=\"yamarket-print__link\" href=\"#\" data-type=\"${document['TYPE']}\">${document['TITLE']}</a>\r\n\t\t\t</li>`).join('')}\r\n\t\t</ul>`);\r\n\r\n\t\tthis._wrapper.appendChild(element);\r\n\t}\r\n}","import ReferenceField from \"../reference/field\";\r\nimport './notification.css';\r\n\r\nexport default class Field extends ReferenceField {\r\n\r\n\tstatic defaults = {}\r\n\r\n\tstatic create(id, settings) {\r\n\t\tconst instance = new Field();\r\n\t\tinstance.initialize(id, settings);\r\n\r\n\t\treturn instance;\r\n\t}\r\n\r\n\trender(value) {\r\n\t\tif (!Array.isArray(value)) { return; }\r\n\r\n\t\tconst html = value.map((one) => `<div class=\"ui-alert ui-alert-${one.type}\">${one.text}</div>`).join('');\r\n\r\n\t\tthis._wrapper.insertAdjacentHTML('beforeend', html);\r\n\t}\r\n\r\n}","import Factory from \"./factory\";\r\nimport Basket from \"./basket/field\";\r\nimport BasketConfirm from \"./basketconfirm/field\";\r\nimport Shipment from \"./shipment/field\";\r\nimport Property from \"./property/field\";\r\nimport Print from \"./print/field\";\r\nimport Notification from \"./notification/field\";\r\nimport Editor from \"./compatible/editor\";\r\nimport './common.css';\r\n\r\n// factory\r\n\r\nconst factory = new Factory({\r\n\tmap: {\r\n\t\tnotification: Notification,\r\n\t\tbasket: Basket,\r\n\t\tbasket_confirm: BasketConfirm,\r\n\t\tshipment: Shipment,\r\n\t\tproperty: Property,\r\n\t\tprint: Print,\r\n\t},\r\n});\r\n\r\nfactory.register();\r\n\r\n// compatible\r\n\r\nconst editor = new Editor();\r\n\r\neditor.start();\r\n\r\nexport {\r\n\tNotification,\r\n\tBasket,\r\n\tBasketConfirm,\r\n\tShipment,\r\n\tProperty,\r\n\tPrint,\r\n};","export default class Editor {\r\n\r\n\tstart() {\r\n\t\tthis.storeOriginDefault();\r\n\t\tthis.handleEditorInit();\r\n\t}\r\n\r\n\thandleEditorInit() {\r\n\t\tBX.addCustomEvent(window, 'BX.UI.EntityEditor:onInit', this.onEditorInit);\r\n\t}\r\n\r\n\tonEditorInit = (editor, data) => {\r\n\t\tif (data.id !== 'yamarket_order_tab') { return; }\r\n\r\n\t\tthis.overrideEditor(editor);\r\n\t\tthis.overrideEditorAjax(editor);\r\n\t\tthis.restoreOriginDefault();\r\n\t}\r\n\r\n\tstoreOriginDefault() {\r\n\t\tthis._originDefault = BX?.UI?.EntityEditor?.getDefault();\r\n\t}\r\n\r\n\trestoreOriginDefault() {\r\n\t\tif (this._originDefault == null) { return; }\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\tBX?.UI?.EntityEditor?.setDefault(this._originDefault);\r\n\t\t});\r\n\t}\r\n\r\n\toverrideEditor(editor) {\r\n\t\tconst createAjaxForm = editor.createAjaxForm;\r\n\r\n\t\tObject.assign(editor, {\r\n\t\t\tvalidate: this.editorValidate.bind(this, editor),\r\n\t\t\tcreateAjaxForm: this.editorCreateAjaxForm.bind(this, editor, createAjaxForm),\r\n\t\t});\r\n\t}\r\n\r\n\teditorValidate(editor, result) {\r\n\t\tconst validator = BX.UI.EntityAsyncValidator.create();\r\n\r\n\t\tfor (const control of editor._activeControls) {\r\n\t\t\tvalidator.addResult(control.validate(result));\r\n\t\t}\r\n\r\n\t\tif (this._userFieldManager) {\r\n\t\t\tvalidator.addResult(this._userFieldManager.validate(result));\r\n\t\t}\r\n\r\n\t\treturn Promise.resolve(validator.validate());\r\n\t}\r\n\r\n\teditorCreateAjaxForm(editor, parentMethod, options, callbacks) {\r\n\t\tconst result = parentMethod.call(editor, options, callbacks);\r\n\r\n\t\tthis.overrideAjaxForm(result);\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\toverrideEditorAjax(editor) {\r\n\t\tthis.overrideAjaxForm(editor._ajaxForm);\r\n\t}\r\n\r\n\toverrideAjaxForm(ajaxForm) {\r\n\t\tif (!ajaxForm || !BX?.UI?.ComponentAjax || !(ajaxForm instanceof BX.UI.ComponentAjax)) { return; }\r\n\r\n\t\tObject.assign(ajaxForm, {\r\n\t\t\tdoSubmit: this.ajaxFormDoSubmit,\r\n\t\t});\r\n\t}\r\n\r\n\tajaxFormDoSubmit(options) {\r\n\t\tconst formData = this._elementNode\r\n\t\t\t? BX.ajax.prepareForm(this._elementNode)\r\n\t\t\t: {data : BX.clone(this._formData), filesCount : 0};\r\n\r\n\t\tif (BX.type.isPlainObject(options.data)) {\r\n\t\t\tfor (const i in options.data) {\r\n\t\t\t\tif (!options.data.hasOwnProperty(i)) { continue; }\r\n\r\n\t\t\t\tformData.data[i] = options.data[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst resultData = formData.filesCount > 0 ? this.makeFormData(formData) : formData;\r\n\r\n\t\tBX.ajax.runComponentAction(this._className, this._actionName, {\r\n\t\t\tmode: 'ajax',\r\n\t\t\tsignedParameters: this._signedParameters,\r\n\t\t\tdata: resultData,\r\n\t\t\tgetParameters: this._getParameters\r\n\t\t})\r\n\t\t\t.then((response) => {\r\n\t\t\t\tconst callback = BX.prop.getFunction(this._callbacks, \"onSuccess\", null);\r\n\r\n\t\t\t\tif (!callback) { return; }\r\n\r\n\t\t\t\tBX.onCustomEvent(\r\n\t\t\t\t\twindow,\r\n\t\t\t\t\t\"BX.UI.EntityEditorAjax:onSubmit\",\r\n\t\t\t\t\t[ response[\"data\"][\"ENTITY_DATA\"], response ]\r\n\t\t\t\t);\r\n\t\t\t\tcallback(response[\"data\"]);\r\n\t\t\t})\r\n\t\t\t.catch((response) => {\r\n\t\t\t\tconst callback = BX.prop.getFunction(this._callbacks, \"onFailure\", null);\r\n\r\n\t\t\t\tif (!callback) { return; }\r\n\r\n\t\t\t\tvar messages = [];\r\n\t\t\t\tvar errors = response[\"errors\"];\r\n\t\t\t\tfor(var i = 0, length = errors.length; i < length; i++) {\r\n\t\t\t\t\tmessages.push(errors[i][\"message\"]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tBX.onCustomEvent(\r\n\t\t\t\t\twindow,\r\n\t\t\t\t\t\"BX.UI.EntityEditorAjax:onSubmitFailure\",\r\n\t\t\t\t\t[ response[\"errors\"] ]\r\n\t\t\t\t);\r\n\r\n\t\t\t\tcallback({ \"ERRORS\": messages });\r\n\t\t\t});\r\n\t}\r\n\r\n}"],"names":["BX","window","Factory","constructor","options","onEditorInit","factory","event","methods","this","name","build","handleEditorInit","type","controlId","settings","prefix","indexOf","internalType","substr","length","map","hasOwnProperty","create","Object","assign","defaults","register","isEditorInitialized","registerEditorMethod","UI","_BX$UI","EntityEditorControlFactory","_BX$UI$EntityEditorCo","initialized","registerFactoryMethod","dir","htmlToElement","html","tag","renderer","document","createElement","innerHTML","firstElementChild","kebabCase","str","split","word","index","toLowerCase","join","copyValues","from","to","fillValues","collectValues","container","inputs","findInputs","result","input","entries","tagName","option","querySelectorAll","selected","value","values","isChanged","Boolean","replaceTemplateVariables","template","variables","key","replace","Field","EntityEditorField","_hasLayout","getMessage","replaces","messages","super","clearLayout","forget","_wrapper","layout","ensureWrapperCreated","adjustWrapper","isNeedToDisplay","registerLayout","isDragEnabled","appendChild","createDragButton","useTitle","title","getTitle","createTitleNode","render","getValue","isContextMenuEnabled","createContextMenuButton","initializeDragDropAbilities","payload","fewElements","selector","getElementSelector","el","getElement","querySelector","SummarySkeleton","onStatusClick","evt","openDialog","preventDefault","bind","handleStatusClick","setup","element","buildStatus","buildForm","cises","optionValue","status","getStatus","reflowStatus","formValue","setAttribute","textContent","Error","useFormValue","reflowForm","modal","messageBox","Dialogs","MessageBox","setMessage","cloneNode","setButtons","SaveButton","events","click","onSaveClick","CancelButton","onCancelClick","show","popupWindow","contentContainer","onChange","close","STATUS_READY","STATUS_WAIT","STATUS_EMPTY","modalElement","statusElement","inputElement","Cis","onCopyClick","copyInternal","handleCopyClick","copy","updateTotal","count","total","internalCises","buildCopyIcon","parseInt","iterator","Array","fill","dummy","selfName","one","inputName","util","htmlspecialchars","typeVariant","required","makeInternalValues","bracketPosition","substring","COUNT","String","dataset","trim","test","optionKey","instances","instancesType","TYPE","itemIndex","instance","keyWithPrefix","copyElement","internalInstances","Digital","buildFormCodes","buildFormAdditional","hasFew","oneValue","ITEM","fieldset","isItemsFilled","filterFilledItems","isSlipFilled","items","item","push","isArray","slip","rawValues","base","keyRelative","keyChain","valueKeyChain","setValueByKeyChain","parts","part","chain","lastKey","pop","level","nextKey","toTree","ItemView","_wires","destroy","forgetWires","extendOptions","basket","columns","keys","COLUMNS","unshift","renderColumn","renderActions","setupWires","mount","point","method","toUpperCase","columnDefault","columnIndex","getName","valueFormatted","columnCis","cis","wire","columnDigital","digital","columnSubsidy","promos","content","promo","columnCount","valueSanitized","parseFloat","callWires","args","apply","formattedKey","field","hasAction","actions","ItemEdit","onCountChange","target","isNaN","onDeleteToggle","isDelete","checked","classList","toggle","disableInput","unbind","handleInputChange","handleDeleteToggle","forEach","ACTION_ITEM","readonly","contains","parentElement","getCountDiff","needDelete","getInputValue","initialCount","getInput","ACTION_CIS","ACTION_DIGITAL","ReferenceField","id","initialize","countChanges","diff","table","renderTable","body","renewItems","ITEMS","basketItem","payloadItems","destroyItems","createItems","payloadItem","createItem","_mode","EntityEditorMode","edit","_editor","showToolPanel","registerActiveControl","_changeHandler","renderHeader","renderSummary","columnTitle","isInEditMode","langKey","lang","SUMMARY","validate","validator","_parent","getChildById","showDialog","Promise","resolve","message","dialogBody","SendButton","onSendClick","reasonControl","productsControl","reasons","changes","change","NAME","error","EntityValidationError","addError","toggleUseDimensions","enabled","useDimensions","buildDefined","buildHeader","buildBody","buildSizes","boxDimensions","inputValue","DIMENSIONS","buildProperties","buildActions","disabled","disabledProperties","boxProperties","property","propertyValue","PROPERTIES","after","updateNumber","number","fulfilmentId","fulfilmentBase","fireChange","onDeleteClick","remove","handleDeleteClick","button","add","fireRemove","dispatchEvent","CustomEvent","detail","bubbles","Collection","onItemRemove","releaseItem","renewNumber","onAddClick","addItem","handleItemRemove","addEventListener","handleAddClick","renderSelf","renderItems","renderAddButton","box","nextIndex","mode","splice","num","last","_this$items","addButton","onTitleActions","context","getParent","useDimensionsNode","renderUseDimensions","definedUseDimensions","customNodes","onUseDimensionsChange","markAsChanged","handleTitleActions","release","handleUseDimensionsChange","node","syncUseDimensions","renderShipments","checkbox","shipmentBoxes","boxCollection","renderShipmentTitle","shipment","insertAdjacentHTML","shipmentCollection","renderShipment","renderShipmentDefined","renderBoxCollection","BoxCollection","onActivityEnd","isMatchActivity","reload","handleActivityEnd","_activityType","broadcast","ACTIVITY_ACTION","_payload$ACTIVITY_ACT","activity","buildActivity","makeActivityMethod","action","text","onclick","JSON","stringify","broadcastElement","onDocumentClick","currentTarget","getItem","url","buildDocumentUrl","createDialog","Show","bindDocumentsClick","link","YandexMarket","PrintDialog","DIALOG_TITLE","TITLE","content_url","width","WIDTH","height","HEIGHT","buttons","btnSave","btnCancel","renderIntro","renderDocuments","notification","Notification","Basket","basket_confirm","BasketConfirm","Shipment","Property","print","Print","editor","data","overrideEditor","overrideEditorAjax","restoreOriginDefault","start","storeOriginDefault","addCustomEvent","_originDefault","_BX","EntityEditor","_BX$UI$EntityEditor","getDefault","setTimeout","setDefault","createAjaxForm","editorValidate","editorCreateAjaxForm","EntityAsyncValidator","control","_activeControls","addResult","_userFieldManager","parentMethod","callbacks","call","overrideAjaxForm","_ajaxForm","ajaxForm","_BX3","_BX3$UI","ComponentAjax","doSubmit","ajaxFormDoSubmit","formData","_elementNode","ajax","prepareForm","clone","_formData","filesCount","isPlainObject","i","resultData","makeFormData","runComponentAction","_className","_actionName","signedParameters","_signedParameters","getParameters","_getParameters","then","response","callback","prop","getFunction","_callbacks","onCustomEvent","catch","errors"],"mappings":"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"}